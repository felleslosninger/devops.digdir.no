<!doctype html><html lang=en><head><title>Devops | Shift-left-security: Sårbarheitsscanning i praksis</title><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"Devops","url":"\/","description":"","thumbnailUrl":"\/images\/digdir_devops.svg"}</script><meta charset=utf-8><meta name=robots content="index,follow"><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><meta name=description content><meta name=keywords content=","><meta http-equiv=content-language content="en"><meta property="og:title" content="Shift-left-security: Sårbarheitsscanning i praksis"><meta name=og:description content><meta property="og:type" content="website"><meta property="og:url" content="/bloggarkiv/blog-security-scan/"><meta property="og:locale" content="en"><link rel=icon type=image/x-icon href=/favicon.ico><link rel=prefetch href=/bloggarkiv/blog-security-scan/><link rel=alternate hreflang=en href=/bloggarkiv/blog-security-scan/ title><link rel=canonical href=/bloggarkiv/blog-security-scan/ itemprop=url><link rel=sitemap type=application/xml title=Sitemap href=/sitemap.xml><link rel=stylesheet href=/main.min.css><script src=https://kit.fontawesome.com/85f464b459.js crossorigin=anonymous></script><link rel=stylesheet href=https://pro.fontawesome.com/releases/v5.10.0/css/all.css integrity=sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p crossorigin=anonymous></head><body><div role=navigation><a class=skip-main href=#main-content tabindex=0>Skip to main content</a></div><header class=header><div class=container><nav role=navigation class="navbar navbar-expand-lg navbar-light p-0"><a href=/ style=margin-right:50px><img class="my-auto header__logo" width=120 height=30 src=/images/digdir_devops.svg alt=logo>
</a><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarNav aria-controls=navbarNav aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse d-lg-flex justify-content-between" id=navbarNav><ul class="navbar-nav mb-2 mb-lg-0"><li class=nav-item><a class=nav-link aria-current=page href=/arrangementarkiv/>Arrangementer</a></li><li class=nav-item><a class=nav-link aria-current=page href=/speakers/>Call for speakers</a></li><li class=nav-item><a class=nav-link aria-current=page href=/om/>Om oss</a></li><li class=nav-item><a class=nav-link aria-current=page href=/info/>Praktisk info</a></li><li class=nav-item><a class=nav-link aria-current=page href=/program/>Program</a></li></ul></div></nav></div></header><main id=main-content><div class="component component--bg-primary"><div class=container><nav style="--bs-breadcrumb-divider:'>'" aria-label=breadcrumb><ol class=breadcrumb><li class=breadcrumb-item><a href=/>Hjem</a></li><li class=breadcrumb-item aria-current=page><a href=/bloggarkiv>Bloggarkiv</a></li><li class="breadcrumb-item active" aria-current=page>Shift-left-security: Sårbarheitsscanning i praksis</li></ol></nav><div class=row><div class=col-lg-7><h1 style=font-size:2.25rem;font-weight:500 class=mb-0>Shift-left-security: Sårbarheitsscanning i praksis</h1><p class="ingress mb-0" style=margin-top:1.5rem>I ei verd der sårbarheiter blir raskt utnytta er sårbarheitscanning av Docker containere eit nyttig verktøy for å unngå at applikasjonane våre har kjente sårbarheiter. Her ser me på nokre mogeleg verktøy blant mange for å gjere dette.</p></div></div></div></div><div class="component component--narrow"><div class=container><div class="d-flex gap-5"><label class=mb-4>Publisert: 27. Apr 2022</label>
<label>Tid: 10 minutter</label>
<label>Forfatter: Randi Øyri</label></div><div class=row><div class="col-lg-7 markdown"><p>I dag leverer dei fleste utviklarar docker images av koden sin uavhengig av programmeringsspråk. Det er stort sett slutt på tida då ein java-utviklar leverte ei svær EAR eller WAR fil eller på andre sære format. Så denne standardiseringa gjer at koden kan køyrast enklare opp og meir likt f.eks. i eit Kubernetes-miljø. Det betyr også at ein kan bruke dei same verktøya for deploy og ulike typar testar, og ikkje minst for for å unngå sårbarheiter. Dette vil me påstå gir oss ei betre verktøykasse å velgje frå.</p><p>Sikkerheit dekkar mykje, så det kan vera vanskeleg å prioritere og ikkje minst rekke over. Her kan Sysdig sin rapport <a href=https://sysdig.com/resources/reports/s-2022-cloud-native-security-and-usage-report/>&ldquo;2022 Cloud-Native Security And Usage Report&rdquo;</a> hjelpe oss å prioritere. Sysdig har undersøkt over 3 millionar containers som anten kundane deiras køyrer eller ligg ope på Github, Docker Hub eller CNCF.</p><img alt=bilde.jpg src=./sysdig-key-trends-2021.jpg><div class=caption>Her ser me tydeleg at i eit container-basert miljø, så har 75% av containerne &ldquo;high&rdquo; eller &ldquo;critical&rdquo; sårbarheiter.</div><p>Den høge andelen alvorlege sårbarheiter funne i containere i bilde over tyder på at me bør ha fokuse på sårbarheitsscanning. Så kva verktøy kan hjelpe oss?</p><p>Men fyrst kort om oss. Me jobbar i dag med å etablere ny systemarkitektur for ID-porten med venner, deriblant ny byggepipeline på Github med Github actions. I den gamle arkitekturen gjorde me alt sjølve med å bygge opp komplette byggepipeline med Jenkins (configuration-as-code) internt. Dette gav oss store fordelar mtp fart, men var også veldig krevjande å vedlikeholde og tungt å oppdatere til nye versjonar av skogen av jenkins plugins. Difor ser me i dag på i større grad å kjøpe dette som ei teneste som let oss fokuser å kjerneapplikasjonane og beholde farten. Der passar Github actions godt inn. Her plukkar me ut actions (slags plugins) me ynskjer og lagar bibliotek med workflow-filer som me kan gjenbruke på tvers av Github repositories. Då finst det også actions som pakkar inn container-scanning tenester som Trivy. <a href=https://aquasecurity.github.io/trivy>Trivy</a> er ei verdsleiande open-source teneste for sårbarheitscanning i byggepipeline i dag. Målsettinga deira er at den skal vera enkel å bruka i CI/CD og er difor eit godt val for oss.</p><p>I dag brukar me Azure/container-scan actions som nyttar Trivy og Dockle. Dockle er container linter som hjelper til med å best practies for å bygge opp docker image og CIS Benchmark. Trivy har også eigen Github action, men denne har me ikkje testa ut. Les meir om desse <a href=https://aquasecurity.github.io/trivy/v0.19.1/advanced/integrations/github-actions/>her</a>.</p><img alt=bilde.jpg src=./container-scan-log4shell.jpg><div class=caption>Me har erfart at container-scan har stoppa log4shell og mange andre sårbarheiter, så dette har gitt oss eit betre sikkerheitsnett, som sårbarheiten oppdaga av Trivy/Container-scan her.</div><h2 id=container-scan-stoppar-meg-frå-å-kode>&ldquo;Container-scan stoppar meg frå å kode&rdquo;</h2><p>Men blir ikkje dette berre meir jobb for utviklarane? Endå ein ting som skal «left»? Vel, det kostar ganske mykje å fikse sårbarheiter i produksjon også og trur at dei som eig produktet set pris på sikkerheitsnettet som sårbarheitscanning gir oss.</p><p>Så nokre små tips til deg frå oss:
Bruk minst mogeleg docker image som base-image, helst distroless med minimalt med os-pakkar. Dess mindre kode, dess mindre potensial for sårbarheiter.
Tilsvaranade i applikasjonen din, treng du eigentleg å ta ein dette 3.-parts biblioteket? Gir det nok verdi? Kan du skrive det same sjølv?</p><p>Hugs å oppdater base docker image.
Velg gjerne noko som oppdaterer min. minor versjonar automatisk, som automatisk bygging av docker images via f.eks. Maven plugins:</p><ul><li>Spring-boot build-image (bruker Packito build tools)</li><li>Google Jib
Desse lagar docker images etter best-practices og oppdaterer base-versjonar, me lever i ein Spring boot verden og har gode erfaringar med å køyre spring boot sin versjon med minimal distro slik:</li></ul><div class=code><code>mvn -B spring-boot:build-image --file pom.xml -Dspring-boot.build-image.imageName=myRegistry/myimage:v1 -Dspring-boot.build-image.builder=paketobuildpacks/builder:tiny</code></div><p>Om du bygger opp docker image sjølv, så ikkje set minor versjon på base-image, men vel major versjon for å få automatisk med neste minor versjon ved bygging. F.eks. for Tomcat eller/og java versjoner. Det krev meir å bygge opp imaget sjøl, du må sjøl passe på å følgje best practices som f.eks. aldri køyr som root. Det gjorde 76% av container i undersøkelsen til Sysdig. Les om best practies f.eks. hos <a href=https://docs.docker.com/develop/develop-images/dockerfile_best-practices/>Docker</a></p><p>Og dersom sårbarheiten stoppar bygget ditt, men du har undersøkt og den er ikkje relevant for din applikasjon? Legg den inn i allowed-list for tillatte unntak. Men ver nøye med å vedlikeholde denne lista og fjerne unntaka etter kvart som bibliotek/os blir patcha.</p><h2 id=produksjon>Produksjon?</h2><p>Å sjekke ny eller endra koda i pipeline er jo fint og flott, men kva med det som er i produksjon? Det er jo produksjon som er viktigast! I produksjon bør ein sjå kva verktøy container-plattforma kan tilby. Azure Portal har sitt <a href=https://azure.microsoft.com/nb-no/services/defender-for-cloud/#features>Security Center/Defender for Cloud</a>. Dette gir varsel og prioriterer sårbarheiter for deg. Tilsvarande har Redhat Openshift enterprise &ldquo;Advanced Cluster Security for Kubernetes&rdquo; som også gir veldig bra overblikk der ein kan drille ned på applikaskjonane/pod-ane. Andre plattformer har sikkert tilsvarande løysingar.</p><p>Sysdig rapporten er også tydleg på at ein bør sjekke både i pipeline og i produksjon:
&ldquo;… all containers are continuously rescanned post deployment to discover any newly disclosed vulnerabilities, but scanning as much as possible pre deployment will prevent known flaws from appearing in production at all.&rdquo;</p><h2 id=dependency-scan>Dependency scan</h2><p>Eit anna verktøy som er veldig nyttig for å unngå sårbarheiter er <a href=https://github.blog/2020-06-01-keep-all-your-packages-up-to-date-with-dependabot/>Github dependabot</a> (o.l. verktøy) som oppdatere bibliotek ved å automatisk opprette Pull Requests. Dette kan konfigurerast til å godkjennast automatisk også om det er non-breaking changes/grønne testar. Ofte ynskjer ein å vera litt restriktiv og undersøkje sjølv også (sjå over endringane i changeloggen). Dette gjera at ein enklare får med seg alle oppdateringar og dermed også sikkerheitspatchar i bibliotekt. Dette kan også konfigurerast til å brukast for dine private repositories.</p><p>Dette var kort om tenester/verktøy me nyttar i skya for å hjelpe oss med å levere kode utan kjente sårbarheiter. Det er nok også mykje anna å velgje i der ute, berre pass på å ta i bruk dei gode verktøya og tenestene som ligg enkelt tilgjengeleg!</p><h2 id=kjelder>Kjelder</h2><div class=footnote>Rapport sysdig: <a href=https://sysdig.com/resources/reports/s-2022-cloud-native-security-and-usage-report/>https://sysdig.com/resources/reports/s-2022-cloud-native-security-and-usage-report/</a>
Github Actions: <a href=https://github.com/features/actions>https://github.com/features/actions</a>
Trivy: <a href=https://aquasecurity.github.io/trivy>https://aquasecurity.github.io/trivy</a>
Azure container-scan: <a href=https://github.com/Azure/container-scan>https://github.com/Azure/container-scan</a>
Trivy github actions: <a href=https://github.com/aquasecurity/trivy>https://github.com/aquasecurity/trivy</a>
Docker best practices: <a href=https://docs.docker.com/develop/develop-images/dockerfile_best-practices/>https://docs.docker.com/develop/develop-images/dockerfile_best-practices/</a>
Spring boot maven plugin for build-image: <a href=https://docs.spring.io/spring-boot/docs/current/maven-plugin/reference/htmlsingle/#goals-build-image>https://docs.spring.io/spring-boot/docs/current/maven-plugin/reference/htmlsingle/#goals-build-image</a>
Google Jib: <a href=https://github.com/GoogleContainerTools/jib>https://github.com/GoogleContainerTools/jib</a>
Azure Portal security center: <a href=https://azure.microsoft.com/nb-no/services/defender-for-cloud/#features>https://azure.microsoft.com/nb-no/services/defender-for-cloud/#features</a>
RedHat Openshift Advanced cluster security for Kubernetes (ACS): <a href=https://cloud.redhat.com/products/kubernetes-security>https://cloud.redhat.com/products/kubernetes-security</a>
Github dependabot: <a href=https://github.blog/2020-06-01-keep-all-your-packages-up-to-date-with-dependabot/>https://github.blog/2020-06-01-keep-all-your-packages-up-to-date-with-dependabot/</a></div></div></div></div></div></main><script>window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?document.getElementById("toTopBtn").style.display="block":document.getElementById("toTopBtn").style.display="none"}function topFunction(){window.scrollTo({top:0,behavior:"smooth"})}</script><style>.to-top-btn{position:fixed;bottom:32px;right:32px;z-index:99;display:none;height:66px;width:66px;line-height:66px;border-radius:50%;text-align:center;background-color:#fff;font-weight:400;transition:.4s all;border:2px solid #000}.to-top-btn span{display:block;color:#000;transition:.4s all;font-size:1.1rem}</style><button class=to-top-btn aria-label="Back to top" onclick=topFunction() id=toTopBtn>
<span style=margin-top:-3px;font-size:2rem class="fa fa-chevron-up"></span></button><footer class="footer component"><div class=figures><svg viewBox="0 0 376 618" fill="none"><ellipse cx="188.079" cy="434.92" rx="183.08" ry="183.079" transform="rotate(-90 188.079 434.92)"/><path d="M0 89.9609 283.756.57064 373.142 284.324 89.3859 373.714.0 89.9609z"/></svg></div><div class=container><div class=row><div class=col-lg-4><h2 class=footer__heading>Digitaliseringsdirektoratet</h2><div class=footer__content><ul class=footer__links><li><a href=https://www.digdir.no/digdir/om-digitaliseringsdirektoratet/1547>About Digitaliseringsdirektoratet</a></li><li><a href=https://www.digdir.no/digdir/jobbe-i-digitaliseringsdirektoratet/705>Work for us</a></li><li><a href=https://www.digdir.no/node/1340>Blog</a></li></ul></div></div><div class=col-lg-4><h2 class=footer__heading>Contact</h2><div class=footer__content><ul class=footer__links><li>Digitaliseringsdirektoratet</li><li>Org.nr. 991 825 827</li></ul><ul class=footer__links><li><a href=https://www.digdir.no/digdir/kontakt-oss/943>Contact us</a></li><li>Phone: 22 45 10 00</li></ul><div class="footer__icons mb-4"><a href=https://www.facebook.com/Digitaliseringsdirektoratet/><i class="fa-facebook-f fab icon footer-icon--facebook" aria-hidden=true tabindex=-1 title=Facebook></i>
</a><a href=https://twitter.com/digdir_no><i class="fa-twitter fab icon footer-icon--twitter" aria-hidden=true tabindex=-1 title=Twitter></i>
</a><a href=https://www.linkedin.com/company/digitaliseringsdirektoratet><i class="fa-linkedin fab icon footer-icon--linkedin" aria-hidden=true tabindex=-1 title=LinkedIn></i></a></div></div></div><div class=col-lg-4><h2 class=footer__heading>About the website</h2><div class=footer__content><ul class=footer__links><li><a href=https://www.digdir.no/om-oss/personvernerklaering/706>Digdirs privacy statement</a></li><li><a href=https://www.digdir.no/om-oss/informasjonskapsler/707>Digdirs information cookies</a></li></ul></div></div></div></div></footer><script src=https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js integrity=sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM crossorigin=anonymous></script><script async src=https://siteimproveanalytics.com/js/siteanalyze_6255470.js></script><script type=text/javascript>window._monsido=window._monsido||{token:"5DJ3zw5xz0Uj0rR8BqtwaA",statistics:{enabled:!0,cookieLessTracking:!0,documentTracking:{enabled:!1,documentCls:"monsido_download",documentIgnoreCls:"monsido_ignore_download",documentExt:[]}}}</script><script type=text/javascript async src=https://app-script.monsido.com/v2/monsido-script.js></script><script>function onLoad(){for(var n,t=document.getElementsByClassName("global-message-alert"),e=0;e<t.length;e++)n=t[e].getAttribute("name"),console.log("on load"),console.log(sessionStorage.getItem(n)),sessionStorage.getItem(n)==void 0&&t[e].classList.remove("d-none")}function hideAlert(){var t,e=event.target||event.srcElement;console.log(e),t=e.getAttribute("name"),console.log(t),sessionStorage.setItem(e.name,1),console.log(sessionStorage.getItem(t))}window.onload=onLoad()</script></body></html>